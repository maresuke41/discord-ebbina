<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Discordé€šçŸ¥ãƒ•ã‚©ãƒ¼ãƒ </title>
</head>
<body>
  <h1>Discord ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³é€šçŸ¥</h1>

  <!-- âŒ actionå±æ€§ã¯æ›¸ã‹ãªã„ï¼ method="post" ã‚‚ä¸è¦ -->
  <form id="form">
    <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</label><br />
    <input type="text" id="userid" required /><br /><br>

    <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label><br />
    <input type="text" id="message" required /><br /><br>

    <button type="submit">é€ä¿¡</button>
  </form>

  <!-- âœ… scriptã¯HTMLã®ä¸€ç•ªæœ€å¾Œã«é…ç½®ï¼ˆformãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œï¼‰ -->
 <script>
  console.log("âœ… JSèª­ã¿è¾¼ã¿ç¢ºèªç”¨ãƒ­ã‚°");

  const form = document.getElementById('form');
  if (!form) {
    console.error("âŒ ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
  } else {
    console.log("âœ… ãƒ•ã‚©ãƒ¼ãƒ å–å¾—æˆåŠŸ");
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    console.log("ğŸš€ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«");

    const userId = document.getElementById('userid').value.trim();
    const message = document.getElementById('message').value.trim();
    console.log("ğŸ“¨ å…¥åŠ›å†…å®¹:", { userId, message });

    if (!userId || !message) {
      alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    console.log("ğŸ“¡ fetché–‹å§‹");

    const res = await fetch('/api/send', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ userId, message })
    });

    console.log("ğŸ“¬ fetchå¿œç­”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", res.status);

    if (res.ok) {
      alert('é€ä¿¡æˆåŠŸï¼');
    } else {
  let errorText = 'é€ä¿¡å¤±æ•—';
try {
  const clone = res.clone(); // â† ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œã‚‹ï¼
  const data = await res.json();
  errorText += ': ' + (data.details || data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
} catch (e) {
  try {
    const text = await res.text();
    errorText += ': ' + text;
  } catch {
    errorText += ': ãƒ¬ã‚¹ãƒãƒ³ã‚¹èª­ã¿å–ã‚Šã‚¨ãƒ©ãƒ¼';
  }
}


      alert(errorText);
    }
  });
</script>
</body> 
</html>
